import{aH as z,k as O,l as g,b7 as D,V as N,R as V,ae as W,M as U}from"./three.module-3Zv0HqI4.js";import{r as c,u as E,d as S,i as B,a as I,k as Z,j as a,c as Y,C as H,T as K,b as j,G as X}from"./CameraControls-BOVxfyb-.js";import{u as $,T as ee}from"./leva.esm-B1dvDXDh.js";import{C as te,T as se}from"./TilesLoadingBar-BENdnHF_.js";import{E as ie,O as G}from"./Ellipsoid-crrCss2v.js";import{D as re}from"./DRACOLoader-Bs_5gK2u.js";import{C as ne}from"./CameraViewTransition-4xJdQ2pH.js";import{E as oe}from"./Environment-D5t7t5eV.js";import{C as ae}from"./CesiumIonAuthPlugin-XNgLn7sc.js";import{G as le}from"./GLTFExtensionsPlugin-DBbpddUd.js";import{T as ue}from"./TileCompressionPlugin-D1wjlOlo.js";import{U as ce}from"./UpdateOnChangePlugin-Q8Vc2vhK.js";import{T as de}from"./TilesFadePlugin-DlDYxCwd.js";import"./EnvironmentControls-D6g5jioQ.js";import"./GlobeControls-DMAWdRLD.js";import"./I3DMLoader-Cjd7CfgJ.js";import"./readMagicBytes-ReGFEf36.js";import"./GLTFLoader-Cn8Xa2Cq.js";import"./TilesRenderer-BLR3IIoh.js";import"./B3DMLoader-Bm_j5TBC.js";import"./PNTSLoader-B_eUeV8U.js";import"./CMPTLoader-DuVi9Tjl.js";import"./EllipsoidRegion-CPTavZ5G.js";import"./CanvasDOMOverlay-v8CzN82q.js";import"./extends-CF3RwP-h.js";import"./CameraTransitionManager-C6nVKL_n.js";import"./constants-s5bY3m4J.js";import"./GeometryClipper-D0mJ9SQx.js";import"./EPSGTilesPlugin-BNtX7JCY.js";import"./ImageFormatPlugin-Cjc_iToZ.js";import"./TMSImageSource-CiQ4Y-oQ.js";import"./TiledImageSource-BKMINnza.js";function J(...h){return c.useCallback(e=>{h.forEach(t=>{t&&(typeof t=="function"?t(e):t.current=e)})},h)}function F(h,e){e(h)||h.children.forEach(t=>{F(t,e)})}class pe extends z{constructor(){super(),this.objects=new Set,this.observed=new Set,this._addedCallback=({child:e})=>{F(e,t=>this.observed.has(t)?!0:(this.objects.add(t),t.addEventListener("childadded",this._addedCallback),t.addEventListener("childremoved",this._removedCallback),this.dispatchEvent({type:"childadded",child:e}),!1))},this._removedCallback=({child:e})=>{F(e,t=>this.observed.has(t)?!0:(this.objects.delete(t),t.removeEventListener("childadded",this._addedCallback),t.removeEventListener("childremoved",this._removedCallback),this.dispatchEvent({type:"childremoved",child:e}),!1))}}observe(e){const{observed:t}=this;this._addedCallback({child:e}),t.add(e)}unobserve(e){const{observed:t}=this;t.delete(e),this._removedCallback({child:e})}dispose(){this.observed.forEach(e=>{this.unobserve(e)})}}const T=new V,M=new D,C=new D,k=new N,w=new g,P=new O;class me extends z{constructor(){super(),this.autoRun=!0,this.queryMap=new Map,this.index=0,this.queued=[],this.scheduled=!1,this.duration=1,this.objects=[],this.observer=new pe,this.ellipsoid=new ie,this.frame=new O,this.cameras=new Set;const e=(()=>{let t=!1;return()=>{t||(t=!0,queueMicrotask(()=>{this.queryMap.forEach(r=>this._enqueue(r)),t=!1}))}})();this.observer.addEventListener("childadded",e),this.observer.addEventListener("childremoved",e)}_enqueue(e){e.queued||(this.queued.push(e),e.queued=!0,this._scheduleRun())}_runJobs(){const{queued:e,cameras:t,duration:r}=this,s=performance.now();for(t.forEach((i,l)=>{P.copy(i.matrixWorldInverse).premultiply(i.projectionMatrix),w.set(0,0,-1).transformDirection(i.matrixWorld),M.start.setFromMatrixPosition(i.matrixWorld),M.end.addVectors(w,M.start);for(let d=0,n=e.length;d<n;d++){const o=e[d],{ray:p}=o;let y,u;if(o.point===null)C.start.copy(p.origin),p.at(1,C.end),he(M,C,k),o.distance=k.x*(1-Math.abs(w.dot(p.direction))),o.inFrustum=!0;else{const m=C.start;m.copy(o.point).applyMatrix4(P),m.x>-1&&m.x<1&&m.y>-1&&m.y<1&&m.z>-1&&m.z<1?(o.distance=m.subVectors(o.point,M.start).dot(w),o.inFrustum=!0):(o.distance=0,o.inFrustum=!1)}l===0?(o.distance=y,o.inFrustum=u):(o.inFrustum=o.inFrustum||u,o.distance=Math.min(o.distance,y))}}),t.length!==0&&e.sort((i,l)=>i.point===null!=(l.point===null)?i.point===null?1:-1:i.inFrustum!==l.inFrustum?i.inFrustum?1:-1:i.distance<0!=l.distance<0?i.distance<0?-1:1:l.distance-i.distance);e.length!==0&&performance.now()-s<r;){const i=e.pop();i.queued=!1,this._updateQuery(i)}e.length!==0&&this._scheduleRun()}_scheduleRun(){this.autoRun&&!this.scheduled&&(this.scheduled=!0,requestAnimationFrame(()=>{this.scheduled=!1,this._runJobs()}))}_updateQuery(e){T.ray.copy(e.ray),T.far="lat"in e?1e4+Math.max(...this.ellipsoid.radius):1/0;const t=T.intersectObjects(this.objects)[0]||null;t!==null&&(e.point===null?e.point=t.point.clone():e.point.copy(t.point)),e.callback(t)}addCamera(e){const{queryMap:t,cameras:r}=this;r.add(e),t.forEach(s=>this._enqueue(s))}deleteCamera(e){const{cameras:t}=this;t.delete(e)}runIfNeeded(e){const{queryMap:t,queued:r}=this,s=t.get(e);s.queued&&(this._updateQuery(s),s.queued=!1,r.splice(r.indexOf(s),1))}setScene(...e){const{observer:t}=this;t.dispose(),e.forEach(r=>t.observe(r)),this.objects=e,this._scheduleRun()}setEllipsoidFromTilesRenderer(e){const{queryMap:t,ellipsoid:r,frame:s}=this;(!r.radius.equals(e.ellipsoid.radius)||!s.equals(e.group.matrixWorld))&&(r.copy(e.ellipsoid),s.copy(e.group.matrixWorld),t.forEach(i=>{if("lat"in i){const{lat:l,lon:d,ray:n}=i;r.getCartographicToPosition(l,d,1e4,n.origin).applyMatrix4(s),r.getCartographicToNormal(l,d,n.direction).transformDirection(s).multiplyScalar(-1)}this._enqueue(i)}))}registerRayQuery(e,t){const r=this.index++,s={ray:e.clone(),callback:t,queued:!1,distance:-1,point:null};return this.queryMap.set(r,s),this._enqueue(s),r}registerLatLonQuery(e,t,r){const{ellipsoid:s,frame:i}=this,l=this.index++,d=new W;s.getCartographicToPosition(e,t,1e4,d.origin).applyMatrix4(i),s.getCartographicToNormal(e,t,d.direction).transformDirection(i).multiplyScalar(-1);const n={ray:d.clone(),lat:e,lon:t,callback:r,queued:!1,distance:-1,point:null};return this.queryMap.set(l,n),this._enqueue(n),l}unregisterQuery(e){const{queued:t,queryMap:r}=this,s=r.get(e);r.delete(e),s&&s.queued&&(s.queued=!1,t.splice(t.indexOf(s),1))}dispose(){this.queryMap.clear(),this.queued.length=0,this.objects.length=0,this.observer.dispose()}}const he=function(){const h=new g,e=new g,t=new g;return function(s,i,l){const d=s.start,n=h,o=i.start,p=e;t.subVectors(d,o),h.subVectors(s.end,s.start),e.subVectors(i.end,i.start);const y=t.dot(p),u=p.dot(n),m=p.dot(p),x=t.dot(n),f=n.dot(n)*m-u*u;let b,q;f!==0?b=(y*u-x*m)/f:b=0,q=(y+b*u)/m,l.x=b,l.y=q}}(),L=c.createContext(null),R=new O,_=new W,fe=c.forwardRef(function(e,t){const{interpolationFactor:r=.025,onQueryUpdate:s=null,...i}=e,l=c.useContext(S),d=c.useContext(L),n=E(({invalidate:x})=>x),o=c.useMemo(()=>new g,[]),p=c.useMemo(()=>({value:!1}),[]),y=c.useMemo(()=>({value:!1}),[]),u=c.useRef(null),m=c.useCallback(x=>{if(l===null||x===null||u.current===null)return;const{lat:v,lon:f,rayorigin:b,raydirection:q}=i;v!==null&&f!==null?(o.copy(x.point),y.value=!0,d.ellipsoid.getObjectFrame(v,f,0,0,0,0,R,G).premultiply(l.group.matrixWorld),u.current.quaternion.setFromRotationMatrix(R),n()):b!==null&&q!==null&&(o.copy(x.point),y.value=!0,u.current.quaternion.identity(),n()),s&&s(x)},[n,y,d.ellipsoid,i,o,l,s]);return I((x,v)=>{if(u.current&&(u.current.visible=p.value),u.current&&y.value)if(p.value===!1)p.value=!0,u.current.position.copy(o);else{const f=1-2**(-v/r);u.current.position.distanceToSquared(o)>1e-6?(u.current.position.lerp(o,r===0?1:f),n()):u.current.position.copy(o)}}),a.jsx(ye,{ref:J(u,t),onQueryUpdate:m,...i})}),ye=c.forwardRef(function(e,t){const{component:r=a.jsx("group",{}),lat:s=null,lon:i=null,rayorigin:l=null,raydirection:d=null,onQueryUpdate:n=null,...o}=e,p=c.useRef(null),y=c.useContext(S),u=c.useContext(L),m=E(({invalidate:v})=>v),x=c.useMemo(()=>new g,[]);return c.useEffect(()=>{const v=f=>{n?n(f):y&&f!==null&&p.current!==null&&(s!==null&&i!==null?(p.current.position.copy(f.point),u.ellipsoid.getObjectFrame(s,i,0,0,0,0,R,G).premultiply(y.group.matrixWorld),p.current.quaternion.setFromRotationMatrix(R),m()):l!==null&&d!==null&&(p.current.position.copy(f.point),p.current.quaternion.identity(),m()))};if(s!==null&&i!==null){const f=u.registerLatLonQuery(s,i,v);return()=>u.unregisterQuery(f)}else if(l!==null&&d!==null){_.origin.copy(l),_.direction.copy(d);const f=u.registerRayQuery(_,v);return()=>u.unregisterQuery(f)}},[s,i,l,d,u,y,m,x,n]),c.cloneElement(r,{...o,ref:J(p,t),raycast:()=>!1})}),xe=c.forwardRef(function(e,t){const r=E(({scene:p})=>p),{scene:s=r,children:i,...l}=e,d=c.useContext(S),n=c.useMemo(()=>new me,[]),o=E(({camera:p})=>p);return B(n,l),c.useEffect(()=>()=>n.dispose(),[n]),c.useEffect(()=>{n.setScene(...Array.isArray(s)?s:[s])},[n,s]),c.useEffect(()=>{n.addCamera(o)},[n,o]),I(()=>{d&&n.setEllipsoidFromTilesRenderer(d)}),Z(n,t),a.jsx(L.Provider,{value:n,children:a.jsx("group",{matrixAutoUpdate:!1,matrixWorldAutoUpdate:!1,children:i})})}),ve=new re().setDecoderPath("https://www.gstatic.com/draco/v1/decoders/"),A=new g,Q=new g;function ge(h){const e=c.useRef();return I(({camera:t})=>{const r=e.current;let s;t.isPerspectiveCamera?(A.setFromMatrixPosition(t.matrixWorld),Q.setFromMatrixPosition(r.matrixWorld),s=.05*A.distanceTo(Q)*Math.atan(t.fov*U.DEG2RAD)):s=(t.top-t.bottom)*.05/t.zoom,s=Math.min(Math.max(s,100),2e5),r.scale.setScalar(s*.5)}),a.jsxs(fe,{ref:e,...h,children:[a.jsxs("mesh",{"position-y":1.25,scale:.5,children:[a.jsx("sphereGeometry",{}),a.jsx("meshStandardMaterial",{color:16007990,emissive:16007990,emissiveIntensity:.25})]}),a.jsxs("mesh",{"position-y":.5,scale:[.1,1,.1],children:[a.jsx("cylinderGeometry",{}),a.jsx("meshStandardMaterial",{color:16007990,emissive:16007990,emissiveIntensity:.25})]})]})}function be(){const h={ortho:!1},e=new Array(500).fill().map((r,s)=>{const i=-Math.PI/2+Math.PI*s/500,l=s;return a.jsx(ge,{lat:i,lon:l,scale:.1},s)}),{ortho:t}=$(h);return a.jsxs(H,{frameloop:"demand",camera:{position:[0,.5*1e7,1.5*1e7]},style:{width:"100%",height:"100%",position:"absolute",margin:0,left:0,top:0},flat:!0,children:[a.jsx("color",{attach:"background",args:[1118481]}),a.jsxs(K,{group:{rotation:[-Math.PI/2,0,0]},children:[a.jsx(j,{plugin:ae,args:{apiToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI3MGNiODVmZS1hNzliLTQ5NWYtOTdhOS02ZmIzMmZlYWRlMzAiLCJpZCI6MjY3NzgzLCJpYXQiOjE3MzY0Mjg0MTJ9.o7EtbJyQ6yNAgfHFal1RS1BKKM-RmZNusqBCeiowNZo",assetId:"2275207",autoRefreshToken:!0}}),a.jsx(j,{plugin:le,dracoLoader:ve}),a.jsx(j,{plugin:ue}),a.jsx(j,{plugin:ce}),a.jsx(j,{plugin:de}),a.jsx(X,{enableDamping:!0}),a.jsx(ne,{mode:t?"orthographic":"perspective"}),a.jsx(ee,{}),a.jsx(te,{}),a.jsx(se,{}),a.jsx(xe,{children:e})]}),a.jsx(oe,{preset:"sunset",backgroundBlurriness:.9,environmentIntensity:1})]})}Y.createRoot(document.getElementById("root")).render(a.jsx(c.StrictMode,{children:a.jsx(be,{})}));
//# sourceMappingURL=settling-CTGXGB8T.js.map
